suite: secrets
templates:
  - templates/secrets.yaml
release:
  name: test-release
  namespace: default
tests:
  - it: should create a VaultStaticSecret
    asserts:
      - isKind:
          of: VaultStaticSecret
      - equal:
          path: apiVersion
          value: secrets.hashicorp.com/v1beta1

  - it: should set the release name as metadata name
    asserts:
      - equal:
          path: metadata.name
          value: test-release

  - it: should use kv-v2 type with homelab mount
    asserts:
      - equal:
          path: spec.type
          value: kv-v2
      - equal:
          path: spec.mount
          value: homelab

  - it: should set the correct vault path
    asserts:
      - equal:
          path: spec.path
          value: software/k3s/test-release

  - it: should set destination name and create flag
    asserts:
      - equal:
          path: spec.destination
          value:
            name: test-release
            create: true

  - it: should set refresh interval to 300s
    asserts:
      - equal:
          path: spec.refreshAfter
          value: 300s

  - it: should reference the correct vault auth
    asserts:
      - equal:
          path: spec.vaultAuthRef
          value: vault-secrets-operator-system/default-auth
