suite: service
templates:
  - templates/service.yaml
release:
  name: test-release
  namespace: default
tests:
  - it: should create a Service
    asserts:
      - isKind:
          of: Service
      - equal:
          path: apiVersion
          value: v1

  - it: should use ClusterIP type
    asserts:
      - equal:
          path: spec.type
          value: ClusterIP

  - it: should set the release name as metadata name
    asserts:
      - equal:
          path: metadata.name
          value: test-release

  - it: should select pods by app labels
    asserts:
      - equal:
          path: spec.selector
          value:
            app.kubernetes.io/name: test-release
            app.kubernetes.io/instance: test-release

  - it: should expose port 80 targeting http
    asserts:
      - contains:
          path: spec.ports
          content:
            name: http
            port: 80
            protocol: TCP
            targetPort: http

  - it: should include standard labels
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: test-release
      - equal:
          path: metadata.labels["app.kubernetes.io/instance"]
          value: test-release
      - equal:
          path: metadata.labels["app.kubernetes.io/managed-by"]
          value: Helm
