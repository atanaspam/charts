suite: persistent volume claims
templates:
  - templates/pvc.yaml
release:
  name: test-release
  namespace: default
tests:
  - it: should create a PVC named config
    asserts:
      - isKind:
          of: PersistentVolumeClaim
      - equal:
          path: metadata.name
          value: config

  - it: should use the correct storage class
    asserts:
      - equal:
          path: spec.storageClassName
          value: truenas-iscsi-csi-retained

  - it: should request 1Gi of storage
    asserts:
      - equal:
          path: spec.resources.requests.storage
          value: 1Gi

  - it: should use ReadWriteOnce access mode
    asserts:
      - contains:
          path: spec.accessModes
          content: ReadWriteOnce

  - it: should include storage component label
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/component"]
          value: storage
